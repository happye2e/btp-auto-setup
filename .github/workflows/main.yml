name: Kyma Btpsa
# This file represents a complete version of the "BTP Setup Automator" integration tests
# All tests are executed in sequence on one BTP account to avoid entitlement limits
# This is why not matrix strategy is used
# The steps of a job must execute in any case, so we use always()

on: push

# variables used by all jobs
env:
  K8S_NAMESPACE: btpsa

jobs:
  integration-test:
    runs-on: ubuntu-latest
    container:
      image: shivakumarp12/btp-setup-automator:latest
      options: --user root

    # variables used only by the job integration-test, move to global, if cleanup or log job need them too
    env:
      BTPSA_PARAM_MYEMAIL: ${{ secrets.BTPSA_PARAM_MYEMAIL }}
      BTPSA_PARAM_GLOBALACCOUNT: ${{ secrets.BTPSA_PARAM_GLOBALACCOUNT_KYMA }}
      BTPSA_PARAM_MYPASSWORD: ${{ secrets.BTPSA_PARAM_MYPASSWORD }}
      USE_CASES: ${{ github.workspace }}/output/use-cases
      
    steps:
      - name: 'Preparing environment'
        working-directory: /home/user
        shell: bash
        env:
          KUBECONFIG: ${{ secrets.SERVICE_ACCOUNT_KYMA1 }}
        run: |
          ls -la
          "$KUBECONFIG" > kubeconfig.yaml
          export KUBECONFIG=./kubeconfig.yaml
          kubectl get ns
          python3 btpsa --help
          
        
